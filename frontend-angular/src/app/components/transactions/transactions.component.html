<div class="transactions-container">
  <div class="header">
    <h1>Transactions</h1>
    <button mat-raised-button color="primary" (click)="openAddTransactionModal()">
      <mat-icon>add</mat-icon>
      Add Transaction
    </button>
  </div>

  <mat-card>
    <mat-card-content>
      <div *ngIf="loading" class="loading">
        Loading transactions...
      </div>

      <table mat-table [dataSource]="transactions" *ngIf="!loading && transactions.length > 0"
        class="transactions-table">
        <ng-container matColumnDef="merchant">
          <th mat-header-cell *matHeaderCellDef>Merchant</th>
          <td mat-cell *matCellDef="let transaction">
            {{ transaction.merchant || transaction.description || 'Unknown' }}
          </td>
        </ng-container>

        <ng-container matColumnDef="category">
          <th mat-header-cell *matHeaderCellDef>Category</th>
          <td mat-cell *matCellDef="let transaction">
            <mat-chip *ngIf="transaction.category">{{ transaction.category | categoryFormat }}</mat-chip>
          </td>
        </ng-container>

        <ng-container matColumnDef="date">
          <th mat-header-cell *matHeaderCellDef>Date</th>
          <td mat-cell *matCellDef="let transaction">
            {{ formatDate(transaction.date) }}
          </td>
        </ng-container>

        <ng-container matColumnDef="amount">
          <th mat-header-cell *matHeaderCellDef>Amount</th>
          <td mat-cell *matCellDef="let transaction">
            ${{ transaction.amount.toFixed(2) }}
          </td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let transaction">
            {{ transaction.status }}
          </td>
        </ng-container>

        <ng-container matColumnDef="anomaly">
          <th mat-header-cell *matHeaderCellDef>Anomaly</th>
          <td mat-cell *matCellDef="let transaction">
            <mat-chip *ngIf="transaction.isAnomaly" color="warn">Anomaly</mat-chip>
          </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let transaction">
            <div class="action-buttons">
              <button *ngIf="transaction.status === 'PENDING'" mat-icon-button color="primary"
                (click)="approveTransaction(transaction)" [disabled]="!canApprove()" matTooltip="Approve">
                <mat-icon>check</mat-icon>
              </button>
              <button *ngIf="transaction.status === 'PENDING'" mat-icon-button color="warn"
                (click)="rejectTransaction(transaction)" [disabled]="!canReject()" matTooltip="Reject">
                <mat-icon>close</mat-icon>
              </button>
              <button mat-icon-button color="warn" (click)="deleteTransaction(transaction)" [disabled]="!canDelete()"
                matTooltip="Delete">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
            <span *ngIf="transaction.status !== 'PENDING'">{{ transaction.status }}</span>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>

      <div *ngIf="!loading && transactions.length === 0" class="empty-state">
        <mat-icon>receipt_long</mat-icon>
        <h3>No transactions</h3>
        <p>Get started by creating a new transaction.</p>
        <button mat-raised-button color="primary" (click)="openAddTransactionModal()">
          <mat-icon>add</mat-icon>
          Add Transaction
        </button>
      </div>
    </mat-card-content>
  </mat-card>
</div>